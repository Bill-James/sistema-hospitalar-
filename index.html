<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gest√£o - Hospital</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyC9UvNolXo5KQKVQD3MQ2NekWSCr1hn1sM",
            authDomain: "sistema-hospitalar-a6345.firebaseapp.com",
            databaseURL: "https://sistema-hospitalar-a6345-default-rtdb.firebaseio.com",
            projectId: "sistema-hospitalar-a6345",
            storageBucket: "sistema-hospitalar-a6345.firebasestorage.app",
            messagingSenderId: "839605236604",
            appId: "1:839605236604:web:ce453247e921b377d3aaf9"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        // C√≥digos de acesso
        const ACCESS_CODES = {
            admin: '1234',
            doctor: '1111',
            exam: '2222',
            reception: '3333',
            pharmacy: '4444'
        };
        // Especialidades dispon√≠veis
const SPECIALTIES = [
    { id: 'clinica-geral', name: 'Cl√≠nica Geral', color: 'green', code: '1111', examRooms: 20 },
    { id: 'medicina', name: 'Medicina', color: 'blue', code: '1112', examRooms: 30 },
    { id: 'obstetricia', name: 'Obstetr√≠cia', color: 'purple', code: '1113', examRooms: 10 },
    { id: 'pediatria', name: 'Pediatria', color: 'yellow', code: '1114', examRooms: 20 },
    { id: 'tratamentos', name: 'Tratamentos', color: 'pink', code: '1115', examRooms: 0 },
    { id: 'psicologia', name: 'Psicologia', color: 'orange', code: '1116', examRooms: 0 },
    { id: 'vacinacao', name: 'PAVI-Vacina', color: 'indigo', code: '1117', examRooms: 0 },
    { id: 'planeamento', name: 'Planeamento Familiar', color: 'teal', code: '1118', examRooms: 10 },
    { id: 'urgencia', name: 'Banco de Urg√™ncia', color: 'red', code: '9999', examRooms: 10 }
];

        const ClinicQueueSystem = () => {
            const [view, setView] = useState('login');
            const [userRole, setUserRole] = useState(null);
            const [userSpecialty, setUserSpecialty] = useState(null);
            const [patients, setPatients] = useState([]);
            const [currentNumber, setCurrentNumber] = useState(1);
            const [calledPatients, setCalledPatients] = useState([]);
            const [examResults, setExamResults] = useState({});

            useEffect(() => {
                const patientsRef = db.ref('patients');
                const calledRef = db.ref('calledPatients');
                const counterRef = db.ref('currentNumber');
                const examRef = db.ref('examResults');

                patientsRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    setPatients(data ? Object.values(data) : []);
                });

                calledRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    setCalledPatients(data ? Object.values(data) : []);
                });

                counterRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) setCurrentNumber(data);
                });

                examRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    setExamResults(data || {});
                });

                return () => {
                    patientsRef.off();
                    calledRef.off();
                    counterRef.off();
                    examRef.off();
                };
            }, []);

            const updatePatient = (patient) => {
                db.ref('patients/' + patient.id).set(patient);
            };

            const addCalledPatient = (patient) => {
                const newCalled = [patient, ...calledPatients.slice(0, 4)];
                db.ref('calledPatients').set(newCalled);
            };

            const saveExamResult = (patientId, result) => {
                db.ref('examResults/' + patientId).set(result);
            };

            const logout = () => {
                setUserRole(null);
                setView('login');
            };

            // Login
            const LoginView = () => {
                const [code, setCode] = useState('');

                const handleLogin = (e) => {
    e.preventDefault();
    
    if (code === ACCESS_CODES.admin) {
        setUserRole('admin');
        setUserSpecialty(null);
        setView('menu');
    } else {
        // Verificar se √© c√≥digo de especialidade
        const specialty = SPECIALTIES.find(s => s.code === code);
        if (specialty) {
            setUserRole('doctor');
            setUserSpecialty(specialty.id);
            setView('doctor');
        } else if (code === ACCESS_CODES.exam) {
            setUserRole('exam');
            setUserSpecialty(null);
            setView('exam');
        } else if (code === ACCESS_CODES.reception) {
            setUserRole('reception');
            setUserSpecialty(null);
            setView('reception');
        } else if (code === ACCESS_CODES.pharmacy) {
            setUserRole('pharmacy');
            setUserSpecialty(null);
            setView('pharmacy');
        } else {
            alert('C√≥digo inv√°lido!');
        }
    }
                    setCode('');
};

                const goPublic = () => {
                    setUserRole('public');
                    setView('public-menu');
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-xl p-8 max-w-md w-full">
                            <h1 className="text-3xl font-bold text-blue-900 mb-6 text-center">üè• Sistema Hospitalar</h1>
                            
                            <form onSubmit={handleLogin} className="mb-4">
                                <label className="block text-sm font-bold mb-2">C√≥digo de Acesso</label>
                                <input
                                    type="password"
                                    value={code}
                                    onChange={(e) => setCode(e.target.value)}
                                    className="w-full p-3 border rounded-lg mb-4 text-center text-2xl"
                                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                    maxLength="4"
                                />
                                <button type="submit" className="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-bold">
                                    Entrar
                                </button>
                            </form>

                            <button onClick={goPublic} className="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg font-bold">
                                üì∫ Acesso P√∫blico
                            </button>
                        </div>
                    </div>
                );
            };

            // Menu P√∫blico
            const PublicMenuView = () => (
                <div className="min-h-screen bg-gradient-to-br from-purple-50 to-purple-100 p-4">
                    <div className="max-w-4xl mx-auto">
                        <button onClick={logout} className="mb-4 text-purple-600 hover:underline font-bold">‚Üê Sair</button>
                        
                        <div className="bg-white rounded-lg shadow-xl p-8">
                            <h1 className="text-3xl font-bold text-purple-900 mb-6 text-center">Acesso P√∫blico</h1>
                            
                            <div className="grid md:grid-cols-2 gap-4">
                                <button onClick={() => setView('display')} className="bg-purple-600 hover:bg-purple-700 text-white p-6 rounded-lg">
                                    <span className="text-3xl">üì∫</span>
                                    <div className="font-bold text-lg mt-2">Painel P√∫blico</div>
                                    <div className="text-sm opacity-90">TV de chamadas</div>
                                </button>

                                <button onClick={() => setView('patient')} className="bg-orange-600 hover:bg-orange-700 text-white p-6 rounded-lg">
                                    <span className="text-3xl">üì±</span>
                                    <div className="font-bold text-lg mt-2">Acompanhar Fila</div>
                                    <div className="text-sm opacity-90">Consultar senha</div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // Menu Admin
            const MenuView = () => (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 p-4">
                    <div className="max-w-4xl mx-auto">
                        <button onClick={logout} className="mb-4 text-blue-600 hover:underline font-bold">‚Üê Sair</button>
                        
                        <div className="bg-white rounded-lg shadow-xl p-8 mb-6">
                            <h1 className="text-3xl font-bold text-blue-900 mb-2">Sistema de Gest√£o Hospitalar</h1>
                            <p className="text-gray-600 mb-6">Posto de Sa√∫de - Administrador</p>
                            
                            <div className="grid md:grid-cols-2 gap-4">
                                <button onClick={() => setView('reception')} className="bg-blue-600 hover:bg-blue-700 text-white p-6 rounded-lg">
                                    <span className="text-3xl">üë•</span>
                                    <div className="font-bold text-lg mt-2">Recep√ß√£o/Triagem</div>
                                </button>

                                <button onClick={() => setView('doctor')} className="bg-green-600 hover:bg-green-700 text-white p-6 rounded-lg">
                                    <span className="text-3xl">ü©∫</span>
                                    <div className="font-bold text-lg mt-2">M√©dico</div>
                                </button>

                                <button onClick={() => setView('exam')} className="bg-teal-600 hover:bg-teal-700 text-white p-6 rounded-lg">
                                    <span className="text-3xl">üî¨</span>
                                    <div className="font-bold text-lg mt-2">Sala de Exames</div>
                                </button>

                                <button onClick={() => setView('pharmacy')} className="bg-pink-600 hover:bg-pink-700 text-white p-6 rounded-lg">
                                    <span className="text-3xl">üíä</span>
                                    <div className="font-bold text-lg mt-2">Farm√°cia</div>
                                </button>

                                <button onClick={() => setView('display')} className="bg-purple-600 hover:bg-purple-700 text-white p-6 rounded-lg">
                                    <span className="text-3xl">üì∫</span>
                                    <div className="font-bold text-lg mt-2">Painel P√∫blico</div>
                                </button>

                                <button onClick={() => setView('patient')} className="bg-orange-600 hover:bg-orange-700 text-white p-6 rounded-lg">
                                    <span className="text-3xl">üì±</span>
                                    <div className="font-bold text-lg mt-2">Paciente</div>
                                </button>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h3 className="font-bold text-lg mb-4">Estat√≠sticas em Tempo Real</h3>
                            <div className="grid grid-cols-4 gap-4 text-center">
                                <div>
                                    <div className="text-3xl font-bold text-blue-600">{patients.filter(p => p.status === 'waiting').length}</div>
                                    <div className="text-sm text-gray-600">Aguardando</div>
                                </div>
                                <div>
                                    <div className="text-3xl font-bold text-green-600">{patients.filter(p => p.status === 'consulting').length}</div>
                                    <div className="text-sm text-gray-600">Em Consulta</div>
                                </div>
                                <div>
                                    <div className="text-3xl font-bold text-teal-600">{patients.filter(p => p.status === 'exam').length}</div>
                                    <div className="text-sm text-gray-600">Em Exame</div>
                                </div>
                                <div>
                                    <div className="text-3xl font-bold text-pink-600">{patients.filter(p => p.status === 'pharmacy').length}</div>
                                    <div className="text-sm text-gray-600">Farm√°cia</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // Recep√ß√£o
            const ReceptionView = () => {
                  const [formData, setFormData] = useState({
    name: '', age: '', weight: '', address: '',
    temperature: '', bloodPressure: '', symptoms: '', priority: 'normal', specialty: ''
});

               const addPatient = () => {
    if (!formData.name.trim() || !formData.age || !formData.specialty) {
        alert('Preencha nome, idade e especialidade!');
        return;
    }
                    
                    const newPatient = {
                        id: Date.now(),
                        number: currentNumber,
                        ...formData,
                        status: 'waiting',
                        examStatus: 'free',
                        timestamp: new Date().toLocaleTimeString('pt-BR'),
                        examRoom: null,
                        prescription: null
                    };

                    db.ref('patients/' + newPatient.id).set(newPatient);
                    db.ref('currentNumber').set(currentNumber + 1);
                    
                  setFormData({
    name: '', age: '', weight: '', address: '',
    temperature: '', bloodPressure: '', symptoms: '', priority: 'normal', specialty: ''
});
                    
                    
                    alert(`‚úÖ Senha ${currentNumber} gerada para ${formData.name}`);
                };

                const backBtn = userRole === 'admin' ? () => setView('menu') : logout;
                const generateReport = () => {
    if (!confirm('Gerar relat√≥rio do dia e resetar sistema?')) return;
    
    // Filtrar apenas pacientes do dia (status completed ou pharmacy)
    const completedPatients = patients.filter(p => 
        p.status === 'completed' || p.status === 'pharmacy' || p.status === 'consulting' || p.status === 'exam'
    );
    
    if (completedPatients.length === 0) {
        alert('Nenhum paciente atendido hoje!');
        return;
    }
    
    // Preparar dados do relat√≥rio
    let reportContent = 'RELAT√ìRIO DI√ÅRIO - POSTO DE SA√öDE\n';
    reportContent += `Data: ${new Date().toLocaleDateString('pt-BR')}\n`;
    reportContent += `Hora: ${new Date().toLocaleTimeString('pt-BR')}\n`;
    reportContent += '='.repeat(80) + '\n\n';
    
    // Estat√≠sticas gerais
    reportContent += 'ESTAT√çSTICAS GERAIS:\n';
    reportContent += `Total de Pacientes Atendidos: ${completedPatients.length}\n`;
    reportContent += `Pacientes Completos: ${patients.filter(p => p.status === 'completed').length}\n`;
    reportContent += `Em Atendimento: ${patients.filter(p => p.status === 'consulting').length}\n`;
    reportContent += `Aguardando Exames: ${patients.filter(p => p.status === 'exam').length}\n`;
    reportContent += `Na Farm√°cia: ${patients.filter(p => p.status === 'pharmacy').length}\n`;
    reportContent += '\n' + '='.repeat(80) + '\n\n';
    
    // Agrupar por especialidade
    const specialtyGroups = {};
    completedPatients.forEach(p => {
        const spec = p.specialty || 'clinica-geral';
        if (!specialtyGroups[spec]) specialtyGroups[spec] = [];
        specialtyGroups[spec].push(p);
    });
    
    // Relat√≥rio por especialidade
    Object.keys(specialtyGroups).forEach(specId => {
        const specialty = SPECIALTIES.find(s => s.id === specId);
        const specName = specialty ? specialty.name : 'Cl√≠nica Geral';
        const specPatients = specialtyGroups[specId];
        
        reportContent += `\n${specName.toUpperCase()} (${specPatients.length} pacientes)\n`;
        reportContent += '-'.repeat(80) + '\n';
        
        specPatients.forEach((p, index) => {
            reportContent += `\n${index + 1}. Senha #${p.number} - ${p.name}\n`;
            reportContent += `   Idade: ${p.age} anos | Peso: ${p.weight || 'N/A'} kg\n`;
            reportContent += `   Temperatura: ${p.temperature || 'N/A'}¬∞C | PA: ${p.bloodPressure || 'N/A'}\n`;
            reportContent += `   Sintomas: ${p.symptoms || 'N/A'}\n`;
            reportContent += `   Chegada: ${p.timestamp}\n`;
            
            if (p.diagnosis) {
                reportContent += `   Diagn√≥stico: ${p.diagnosis}\n`;
            }
            
            if (p.examType) {
                reportContent += `   Exame Realizado: ${p.examType}\n`;
                if (examResults[p.id]) {
                    reportContent += `   Resultado: ${examResults[p.id].result}\n`;
                } else {
                    reportContent += `   Resultado: PENDENTE\n`;
                }
            }
            
            if (p.prescription) {
                reportContent += `   Receita: ${p.prescription}\n`;
                reportContent += `   Medicamentos: ${p.status === 'completed' ? 'ENTREGUES' : 'PENDENTE'}\n`;
            }
            
            reportContent += `   Status Final: ${p.status === 'completed' ? 'CONCLU√çDO' : p.status.toUpperCase()}\n`;
        });
    });
    
    reportContent += '\n\n' + '='.repeat(80) + '\n';
    reportContent += 'FIM DO RELAT√ìRIO\n';
    
    // Download do arquivo
    const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `relatorio_${new Date().toLocaleDateString('pt-BR').replace(/\//g, '-')}_${new Date().toLocaleTimeString('pt-BR').replace(/:/g, '-')}.txt`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
    
    // Resetar sistema
    if (confirm('Relat√≥rio gerado! Deseja resetar o sistema agora?')) {
        db.ref('patients').set({});
        db.ref('calledPatients').set([]);
        db.ref('examResults').set({});
        db.ref('currentNumber').set(1);
        alert('‚úÖ Sistema resetado com sucesso!');
    }
};

                return (
                    <div className="min-h-screen bg-blue-50 p-4">
                        <div className="max-w-3xl mx-auto">
                            <button onClick={backBtn} className="mb-4 text-blue-600 hover:underline font-bold">‚Üê Voltar</button>
                            
                            <div className="bg-white rounded-lg shadow-xl p-6 mb-4">
                                <h2 className="text-2xl font-bold text-blue-900 mb-6">üìã Recep√ß√£o - Triagem</h2>
                                
                                <div className="grid md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label className="block text-sm font-bold mb-2">Nome Completo *</label>
                                        <input type="text" value={formData.name} 
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            className="w-full p-3 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold mb-2">Idade *</label>
                                        <input type="number" value={formData.age}
                                            onChange={(e) => setFormData({...formData, age: e.target.value})}
                                            className="w-full p-3 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold mb-2">Peso (kg)</label>
                                        <input type="number" value={formData.weight}
                                            onChange={(e) => setFormData({...formData, weight: e.target.value})}
                                            className="w-full p-3 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold mb-2">Temperatura (¬∞C)</label>
                                        <input type="number" step="0.1" value={formData.temperature}
                                            onChange={(e) => setFormData({...formData, temperature: e.target.value})}
                                            className="w-full p-3 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold mb-2">Press√£o Arterial</label>
                                        <input type="text" value={formData.bloodPressure}
                                            onChange={(e) => setFormData({...formData, bloodPressure: e.target.value})}
                                            className="w-full p-3 border rounded-lg" placeholder="120/80" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold mb-2">Prioridade</label>
                                        <select value={formData.priority}
                                            onChange={(e) => setFormData({...formData, priority: e.target.value})}
                                            className="w-full p-3 border rounded-lg">
                                            <option value="normal">Normal</option>
                                            <option value="priority">Priorit√°rio</option>
                                            <option value="urgent">Urgente</option>
                                        </select>
                                    </div>
                                    <div>
    <label className="block text-sm font-bold mb-2">Especialidade *</label>
    <select value={formData.specialty || ''}
        onChange={(e) => setFormData({...formData, specialty: e.target.value})}
        className="w-full p-3 border rounded-lg">
        <option value="">Selecione...</option>
        {SPECIALTIES.map(s => (
            <option key={s.id} value={s.id}>{s.name}</option>
        ))}
    </select>
</div>
                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-bold mb-2">Morada</label>
                                        <input type="text" value={formData.address}
                                            onChange={(e) => setFormData({...formData, address: e.target.value})}
                                            className="w-full p-3 border rounded-lg" />
                                    </div>
                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-bold mb-2">Sintomas</label>
                                        <textarea value={formData.symptoms}
                                            onChange={(e) => setFormData({...formData, symptoms: e.target.value})}
                                            className="w-full p-3 border rounded-lg" rows="3"></textarea>
                                    </div>
                                </div>

                                <button onClick={addPatient} className="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-lg font-bold">
                                    üé´ Gerar Senha
                                </button>
                                {(userRole === 'admin' || userRole === 'reception') && patients.length > 0 && (
    <button onClick={generateReport} 
        className="w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-bold mt-4">
        üìä Gerar Relat√≥rio e Resetar Sistema
    </button>
)}

                                <div className="mt-6 bg-blue-100 p-6 rounded-lg text-center">
                                    <div className="text-sm text-gray-600">√öltima Senha</div>
                                    <div className="text-6xl font-bold text-blue-900">{currentNumber - 1}</div>
                                </div>
                            </div>

                            {userRole === 'reception' && (
                                <button onClick={() => setView('patient')} className="w-full bg-orange-600 hover:bg-orange-700 text-white py-4 rounded-lg font-bold">
                                    üì± Acompanhar Fila
                                </button>
                            )}
                        </div>
                    </div>
                );
            };

            // M√©dico
            const DoctorView = () => {
                const [diagnosis, setDiagnosis] = useState('');
                const [needsExam, setNeedsExam] = useState(false);
                const [examType, setExamType] = useState('');
                const [prescription, setPrescription] = useState('');

                const selectedPatient = patients.find(p => 
    p.status === 'consulting' && p.specialty === userSpecialty
) || null;

                const waitingPatients = patients.filter(p => 
    p.status === 'waiting' && p.specialty === userSpecialty
)
                    .sort((a, b) => {
                        if (a.priority === 'urgent' && b.priority !== 'urgent') return -1;
                        if (b.priority === 'urgent' && a.priority !== 'urgent') return 1;
                        if (a.priority === 'priority' && b.priority === 'normal') return -1;
                        if (b.priority === 'priority' && a.priority === 'normal') return 1;
                        return a.number - b.number;
                    });

                const callPatient = (patient) => {
                    if (selectedPatient) {
                        alert('Finalize o atendimento atual primeiro!');
                        return;
                    }
                    updatePatient({...patient, status: 'consulting'});
                    addCalledPatient(patient);
                };

                const sendToExam = () => {
    if (!examType) return alert('Selecione o tipo de exame!');
    
    const specialty = SPECIALTIES.find(s => s.id === userSpecialty);
    const examRooms = specialty?.examRooms || 0;
    
    // Especialidades sem salas usam Cl√≠nica Geral
    const targetSpecialty = examRooms === 0 ? 'clinica-geral' : userSpecialty;
    const targetRooms = examRooms === 0 ? 20 : examRooms;
    
    // Buscar salas ocupadas da especialidade alvo
    const occupiedRooms = patients
        .filter(p => p.examRoom && p.examSpecialty === targetSpecialty)
        .map(p => p.examRoom);
    
    // Encontrar sala livre
    let availableRoom = null;
    for (let i = 1; i <= targetRooms; i++) {
        if (!occupiedRooms.includes(i)) {
            availableRoom = i;
            break;
        }
    }
    
    if (!availableRoom) {
        return alert(`‚ö†Ô∏è CAPACIDADE M√ÅXIMA ATINGIDA!\n\nTodas as ${targetRooms} salas de exame est√£o ocupadas.\nAguarde a libera√ß√£o de uma sala antes de novos encaminhamentos.`);
    }

    updatePatient({
        ...selectedPatient,
        status: 'exam',
        diagnosis,
        examType,
        examRoom: availableRoom,
        examSpecialty: targetSpecialty,
        originSpecialty: userSpecialty,
        examStatus: 'occupied'
    });
    
    setDiagnosis('');
    setExamType('');
    setNeedsExam(false);
    alert(`‚úÖ Enviado para Sala ${availableRoom} de ${specialty?.name || 'Cl√≠nica Geral'}`);
};

                const sendToPharmacy = () => {
                    if (!prescription) return alert('Digite a receita!');
                    
                    updatePatient({
                        ...selectedPatient,
                        status: 'pharmacy',
                        diagnosis,
                        prescription
                    });
                    setDiagnosis('');
                    setPrescription('');
                    alert('‚úÖ Enviado para farm√°cia!');
                };

                const completeConsultation = () => {
                    updatePatient({...selectedPatient, status: 'completed'});
                    setDiagnosis('');
                    alert('‚úÖ Consulta finalizada!');
                };

                const backBtn = userRole === 'admin' ? () => setView('menu') : logout;

                return (
                    <div className="min-h-screen bg-green-50 p-4">
                        <div className="max-w-6xl mx-auto">
                            <button onClick={backBtn} className="mb-4 text-green-600 hover:underline font-bold">‚Üê Voltar</button>
                            
                            <div className="grid md:grid-cols-2 gap-6">
                                <div className="bg-white rounded-lg shadow-xl p-6">
                                    <h2 className="text-2xl font-bold text-green-900 mb-6">
    ü©∫ Painel do M√©dico - {SPECIALTIES.find(s => s.id === userSpecialty)?.name || 'Cl√≠nica Geral'}
</h2>
                                    
                                    {selectedPatient ? (
                                        <div className="space-y-4">
                                            <div className="bg-green-100 p-4 rounded-lg">
                                                <h3 className="font-bold text-lg">Em Consulta</h3>
                                                <div className="text-2xl font-bold text-green-900">#{selectedPatient.number} - {selectedPatient.name}</div>
                                                <div className="grid grid-cols-2 gap-2 mt-3 text-sm">
                                                    <div><strong>Idade:</strong> {selectedPatient.age} anos</div>
                                                    <div><strong>Peso:</strong> {selectedPatient.weight} kg</div>
                                                    <div><strong>Temp:</strong> {selectedPatient.temperature}¬∞C</div>
                                                    <div><strong>PA:</strong> {selectedPatient.bloodPressure}</div>
                                                    <div className="col-span-2"><strong>Sintomas:</strong> {selectedPatient.symptoms}</div>
                                                </div>
                                            </div>

                                            <div>
                                                <label className="block font-bold mb-2">Diagn√≥stico</label>
                                                <textarea value={diagnosis} onChange={(e) => setDiagnosis(e.target.value)}
                                                    className="w-full p-3 border rounded-lg" rows="3"></textarea>
                                            </div>

                                            <div className="flex items-center gap-2">
                                                <input type="checkbox" checked={needsExam} onChange={(e) => setNeedsExam(e.target.checked)} className="w-5 h-5" />
                                                <label className="font-bold">Precisa de Exames?</label>
                                            </div>

                                            {needsExam && (
                                                <div>
                                                    <select value={examType} onChange={(e) => setExamType(e.target.value)} className="w-full p-3 border rounded-lg mb-2">
                                                        <option value="">Selecione...</option>
<option value="Pesquisa de plasmodium">Pesquisa de plasmodium</option>
<option value="Rea√ß√£o widal">Rea√ß√£o widal</option>
<option value="Hemograma completo">Hemograma completo</option>
<option value="Falciforma√ß√£o">Falciforma√ß√£o</option>
<option value="Grupo sangu√≠neo">Grupo sangu√≠neo</option>
<option value="Teste r√°pido s√≠filis">Teste r√°pido s√≠filis</option>
<option value="Teste r√°pido Hbsag">Teste r√°pido Hbsag</option>
<option value="Teste r√°pido Hcv">Teste r√°pido Hcv</option>
<option value="Teste r√°pido Dengue">Teste r√°pido Dengue</option>
<option value="Teste r√°pido chicungunia">Teste r√°pido chicungunia</option>
<option value="Teste de gravidez">Teste de gravidez</option>
<option value="Urina">Urina</option>
<option value="Tempo hemorragia">Tempo hemorragia</option>
<option value="Tempo de coagula√ß√£o">Tempo de coagula√ß√£o</option>
<option value="Velocidade hemossedimenta√ß√£o">Velocidade hemossedimenta√ß√£o</option>
<option value="CD4">CD4</option>
<option value="Carga viral interna">Carga viral interna</option>
<option value="Glic√©mia em jejum">Glic√©mia em jejum</option>
<option value="Ureia">Ureia</option>
<option value="Triglicer√≠deos">Triglicer√≠deos</option>
<option value="Transaminases AST">Transaminases AST</option>
<option value="Fosfatase alcalina">Fosfatase alcalina</option>
<option value="Colesterol total">Colesterol total</option>
                                                    </select>
                                                    <button onClick={sendToExam} className="w-full bg-teal-600 hover:bg-teal-700 text-white py-3 rounded-lg font-bold">
                                                        üî¨ Enviar para Exame
                                                    </button>
                                                </div>
                                            )}

                                            {!needsExam && (
                                                <div>
                                                    <label className="block font-bold mb-2">Receita M√©dica</label>
                                                    <textarea value={prescription} onChange={(e) => setPrescription(e.target.value)}
                                                        className="w-full p-3 border rounded-lg mb-2" rows="4"></textarea>
                                                    <button onClick={sendToPharmacy} className="w-full bg-pink-600 hover:bg-pink-700 text-white py-3 rounded-lg font-bold">
                                                        üíä Enviar para Farm√°cia
                                                    </button>
                                                </div>
                                            )}

                                            <button onClick={completeConsultation} className="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-bold">
                                                ‚úÖ Finalizar Consulta
                                            </button>
                                        </div>
                                    ) : (
                                        <div className="bg-gray-100 p-6 rounded-lg text-center text-gray-600">
                                            Nenhum paciente em consulta
                                        </div>
                                    )}
                                </div>

                                <div className="bg-white rounded-lg shadow-xl p-6">
                                    <h3 className="font-bold text-lg mb-4">Fila de Espera ({waitingPatients.length})</h3>
                                    <div className="space-y-2 max-h-96 overflow-y-auto">
                                        {waitingPatients.map(p => (
                                            <div key={p.id} className="bg-gray-50 p-3 rounded">
                                                <div className="flex justify-between items-center mb-2">
                                                    <div>
                                                        <span className="font-bold text-lg">#{p.number}</span>
                                                        <span className="ml-2">{p.name}</span>
                                                    </div>
                                                    <button onClick={() => callPatient(p)} disabled={selectedPatient !== null}
                                                        className="bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2 rounded font-bold">
                                                        Chamar
                                                    </button>
                                                </div>
                                                <div className="text-xs text-gray-600">
                                                    {p.age} anos ‚Ä¢ {p.temperature}¬∞C ‚Ä¢ PA: {p.bloodPressure}
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="mt-6">
                                        <h3 className="font-bold mb-4 text-blue-900">üîÑ Retornaram do Exame</h3>
                                        {patients.filter(p => p.status === 'exam' && 
        p.originSpecialty === userSpecialty &&
        p.examStatus === 'completed' &&
        examResults[p.id]
    ).map(p => (
                                            <div key={p.id} className="bg-blue-50 p-3 rounded mb-2 border-2 border-blue-300">
                                                <div className="flex justify-between items-center">
                                                   <div>
    <div className="font-bold">#{p.number} - {p.name}</div>
    <div className="text-sm text-gray-600">
        {p.examType} - ‚úÖ Resultado pronto
    </div>
    {examResults[p.id] && (
        <div className="mt-2 p-3 bg-white rounded border border-blue-200">
            <div className="text-xs font-bold text-gray-700 mb-1">üìã Resultado do Exame:</div>
            <div className="text-sm text-gray-900 whitespace-pre-wrap">
                {examResults[p.id].result}
            </div>
        </div>
    )}
</div>
                                                    <button 
                                                        onClick={() => {
                                                            if (selectedPatient) {
                                                                alert('Finalize o atendimento atual primeiro!');
                                                                return;
                                                            }
                                                            updatePatient({...p, status: 'consulting', examRoom: null});
                                                            addCalledPatient(p);
                                                        }}
                                                        disabled={selectedPatient !== null}
                                                        className="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-4 py-2 rounded font-bold">
                                                        Chamar
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="mt-6">
    <h3 className="font-bold mb-4">Aguardando Exames</h3>
    {patients.filter(p => p.status === 'exam').map(p => (
        <div key={p.id} className="bg-teal-50 p-3 rounded mb-2">
            <div className="font-bold">#{p.number} - {p.name}</div>
            <div className="text-sm">Sala {p.examRoom} - {p.examType}</div>
        </div>
    ))}
</div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Sala de Exames
           const ExamView = () => {
    const [selectedSpecialty, setSelectedSpecialty] = useState('');
    const [roomNumber, setRoomNumber] = useState('');
    const [result, setResult] = useState('');
    const [inProgressExams, setInProgressExams] = useState([]);

    const specialtiesWithExams = SPECIALTIES.filter(s => s.examRooms > 0);
    
    const examPatients = selectedSpecialty
        ? patients.filter(p => p.status === 'exam' && p.examSpecialty === selectedSpecialty)
        : [];
    
    const myPatient = roomNumber && selectedSpecialty
        ? examPatients.find(p => p.examRoom === parseInt(roomNumber) && p.examSpecialty === selectedSpecialty)
        : null;

    const startExam = (patient) => {
        setInProgressExams([...inProgressExams, patient.id]);
        updatePatient({...patient, examStatus: 'in-progress'});
    };

    const sendResult = () => {
        if (!result || !myPatient) return alert('Preencha o resultado!');
        
        saveExamResult(myPatient.id, {
            result,
            timestamp: new Date().toLocaleTimeString('pt-BR')
        });
        
        updatePatient({
            ...myPatient,
            examStatus: 'completed',
            examRoom: null,
            examSpecialty: null
        });
        
        setResult('');
        setRoomNumber('');
        alert('‚úÖ Resultado enviado e sala liberada!');
    };

    const backBtn = userRole === 'admin' ? () => setView('menu') : logout;

    return (
        <div className="min-h-screen bg-teal-50 p-4">
            <div className="max-w-5xl mx-auto">
                <button onClick={backBtn} className="mb-4 text-teal-600 hover:underline font-bold">‚Üê Voltar</button>
                
                <div className="bg-white rounded-lg shadow-xl p-6">
                    <h2 className="text-2xl font-bold text-teal-900 mb-6">üî¨ Sala de Exames</h2>
                    
                    {/* Sele√ß√£o de Especialidade */}
                    <div className="mb-4">
                        <label className="block text-sm font-bold mb-2">Especialidade:</label>
                        <select 
                            value={selectedSpecialty}
                            onChange={(e) => {
                                setSelectedSpecialty(e.target.value);
                                setRoomNumber('');
                            }}
                            className="w-full p-3 border rounded-lg"
                        >
                            <option value="">Selecione uma especialidade...</option>
                            {specialtiesWithExams.map(s => (
                                <option key={s.id} value={s.id}>{s.name}</option>
                            ))}
                        </select>
                    </div>

                    {/* Sele√ß√£o de Sala */}
                    {selectedSpecialty && (
                        <div className="mb-4">
                            <label className="block text-sm font-bold mb-2">N√∫mero da Sala:</label>
                            <select 
                                value={roomNumber}
                                onChange={(e) => setRoomNumber(e.target.value)}
                                className="w-full p-3 border rounded-lg"
                            >
                                <option value="">Selecione uma sala...</option>
                                {Array.from({length: SPECIALTIES.find(s => s.id === selectedSpecialty)?.examRooms || 0}, (_, i) => i + 1).map(room => (
                                    <option key={room} value={room}>Sala {room}</option>
                                ))}
                            </select>
                        </div>
                    )}

                    {/* Paciente da Sala Selecionada */}
                    {myPatient ? (
                        <div className="bg-teal-50 p-6 rounded-lg border-2 border-teal-300 mb-6">
                            <div className="mb-4">
                                <div className="text-3xl font-bold text-teal-900">Senha #{myPatient.number}</div>
                                <div className="text-xl font-bold mt-2">{myPatient.name}</div>
                                <div className="text-sm text-gray-600 mt-2">
                                    <div><strong>Idade:</strong> {myPatient.age} anos</div>
                                    <div><strong>Origem:</strong> {SPECIALTIES.find(s => s.id === myPatient.originSpecialty)?.name}</div>
                                    <div><strong>Tipo de Exame:</strong> {myPatient.examType}</div>
                                    {myPatient.diagnosis && <div><strong>Diagn√≥stico:</strong> {myPatient.diagnosis}</div>}
                                </div>
                            </div>

                            {myPatient.examStatus === 'occupied' && (
                                <button 
                                    onClick={() => startExam(myPatient)}
                                    className="w-full bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-lg font-bold mb-3"
                                >
                                    üü† Iniciar Exame
                                </button>
                            )}
                            
                            {myPatient.examStatus === 'in-progress' && (
                                <div>
                                    <label className="block text-sm font-bold mb-2">Resultado do Exame:</label>
                                    <textarea
                                        value={result}
                                        onChange={(e) => setResult(e.target.value)}
                                        placeholder="Digite o resultado do exame..."
                                        className="w-full p-3 border rounded-lg mb-3"
                                        rows="6"
                                    />
                                    <button 
                                        onClick={sendResult}
                                        className="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-bold"
                                    >
                                        ‚úÖ Enviar Resultado e Liberar Sala
                                    </button>
                                </div>
                            )}
                        </div>
                    ) : selectedSpecialty && roomNumber ? (
                        <div className="bg-gray-100 p-6 rounded-lg text-center text-gray-600 mb-6">
                            Sala {roomNumber} est√° livre
                        </div>
                    ) : null}

                    {/* Mapa de Salas */}
                    {selectedSpecialty && (
                        <div className="mt-6">
                            <h3 className="font-bold text-lg mb-3">
                                Mapa de Salas - {SPECIALTIES.find(s => s.id === selectedSpecialty)?.name}
                            </h3>
                            <div className="grid grid-cols-5 gap-3">
                                {Array.from({length: SPECIALTIES.find(s => s.id === selectedSpecialty)?.examRooms || 0}, (_, i) => {
                                    const room = i + 1;
                                    const patient = examPatients.find(p => p.examRoom === room);
                                    const status = patient ? patient.examStatus : 'free';
                                    
                                    const colors = {
                                        free: 'bg-green-500',
                                        occupied: 'bg-red-500',
                                        'in-progress': 'bg-orange-500',
                                        completed: 'bg-blue-500'
                                    };
                                    
                                    const labels = {
                                        free: 'üü¢ Livre',
                                        occupied: 'üî¥ Ocupada',
                                        'in-progress': 'üü† Em Andamento',
                                        completed: 'üîµ Conclu√≠da'
                                    };
                                    
                                    return (
                                        <div 
                                            key={room} 
                                            className={`${colors[status]} text-white p-4 rounded-lg text-center cursor-pointer hover:opacity-80 transition`}
                                            onClick={() => setRoomNumber(room.toString())}
                                        >
                                            <div className="font-bold text-lg">Sala {room}</div>
                                            {patient && <div className="text-xs mt-1">#{patient.number}</div>}
                                            <div className="text-xs mt-1">{labels[status]}</div>
                                        </div>
                                    );
                                })}
                            </div>
                            
                            <div className="mt-4 grid grid-cols-4 gap-2 text-sm">
                                <div className="flex items-center gap-2">
                                    <div className="w-4 h-4 bg-green-500 rounded"></div>
                                    <span>Livre</span>
                                </div>
                                <div className="flex items-center gap-2">
                                    <div className="w-4 h-4 bg-red-500 rounded"></div>
                                    <span>Ocupada</span>
                                </div>
                                <div className="flex items-center gap-2">
                                    <div className="w-4 h-4 bg-orange-500 rounded"></div>
                                    <span>Em Andamento</span>
                                </div>
                                <div className="flex items-center gap-2">
                                    <div className="w-4 h-4 bg-blue-500 rounded"></div>
                                    <span>Conclu√≠da</span>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );
};

            // Farm√°cia
            const PharmacyView = () => {
                const [showCompleted, setShowCompleted] = useState(false);
                const pharmacyPatients = patients.filter(p => p.status === 'pharmacy');
                const completedPharmacy = patients.filter(p => p.status === 'completed' && p.prescription);

                const deliverMedicine = (patient) => {
                    updatePatient({...patient, status: 'completed'});
                    alert(`‚úÖ Medicamentos entregues a ${patient.name}`);
                };

                const backBtn = userRole === 'admin' ? () => setView('menu') : logout;

                return (
                    <div className="min-h-screen bg-pink-50 p-4">
                        <div className="max-w-5xl mx-auto">
                            <button onClick={backBtn} className="mb-4 text-pink-600 hover:underline font-bold">‚Üê Voltar</button>
                            
                            <div className="bg-white rounded-lg shadow-xl p-6 mb-4">
                                <h2 className="text-2xl font-bold text-pink-900 mb-6">üíä Farm√°cia - Receitas M√©dicas</h2>
                                
                                {pharmacyPatients.length === 0 ? (
                                    <div className="bg-gray-100 p-8 rounded-lg text-center text-gray-600">
                                        Nenhuma receita pendente no momento
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        {pharmacyPatients.map(p => (
                                            <div key={p.id} className="bg-pink-50 p-4 rounded-lg border-2 border-pink-200">
                                                <div className="flex justify-between items-start mb-3">
                                                    <div>
                                                        <div className="text-2xl font-bold text-pink-900">
                                                            #{p.number} - {p.name}
                                                        </div>
                                                        <div className="text-sm text-gray-600 mt-1">
                                                            {p.age} anos ‚Ä¢ Chegou √†s {p.timestamp}
                                                        </div>
                                                    </div>
                                                    <button onClick={() => deliverMedicine(p)}
                                                        className="bg-pink-600 hover:bg-pink-700 text-white px-6 py-3 rounded-lg font-bold">
                                                        ‚úÖ Entregar Medicamentos
                                                    </button>
                                                </div>

                                                {p.diagnosis && (
                                                    <div className="bg-white p-3 rounded mb-3">
                                                        <div className="text-sm font-bold text-gray-700">Diagn√≥stico:</div>
                                                        <div className="text-gray-900">{p.diagnosis}</div>
                                                    </div>
                                                )}

                                                <div className="bg-white p-4 rounded border border-pink-300">
                                                    <div className="text-sm font-bold text-pink-900 mb-2">üìù RECEITA M√âDICA</div>
                                                    <div className="whitespace-pre-wrap text-gray-900">{p.prescription}</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>

                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h3 className="font-bold text-lg mb-4">Estat√≠sticas da Farm√°cia</h3>
                                <div className="grid grid-cols-3 gap-4 text-center">
                                    <div>
                                        <div className="text-3xl font-bold text-pink-600">{pharmacyPatients.length}</div>
                                        <div className="text-sm text-gray-600">Aguardando</div>
                                    </div>
                                    <div>
                                        <button onClick={() => setShowCompleted(!showCompleted)}
                                            className="w-full hover:bg-pink-50 p-2 rounded transition">
                                            <div className="text-3xl font-bold text-green-600">{completedPharmacy.length}</div>
                                            <div className="text-sm text-gray-600">Total de Receitas</div>
                                        </button>
                                    </div>
                                    <div>
                                        <div className="text-3xl font-bold text-blue-600">
                                            {patients.filter(p => p.prescription).length}
                                        </div>
                                        <div className="text-sm text-gray-600">Receitas Emitidas</div>
                                    </div>
                                </div>

                                {showCompleted && (
                                    <div className="mt-6 border-t pt-4">
                                        <h4 className="font-bold mb-3">Lista Completa de Medicamentos Dispensados</h4>
                                        <div className="space-y-2 max-h-96 overflow-y-auto">
                                            {completedPharmacy.map(p => (
                                                <div key={p.id} className="bg-gray-50 p-3 rounded">
                                                    <div className="font-bold">#{p.number} - {p.name}</div>
                                                    <div className="text-sm text-gray-600">
                                                        <strong>Medicamento:</strong> {p.prescription}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            // Painel P√∫blico
            const DisplayView = () => {
                const [currentTime, setCurrentTime] = useState(new Date());
                const lastCalled = calledPatients[0];

                useEffect(() => {
                    const timer = setInterval(() => setCurrentTime(new Date()), 1000);
                    return () => clearInterval(timer);
                }, []);

                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-900 to-purple-700 p-8">
                        <div className="max-w-7xl mx-auto">
                            {userRole !== 'public' && (
                                <button onClick={() => userRole === 'admin' ? setView('menu') : setView('public-menu')} 
                                    className="mb-4 text-white hover:underline font-bold">‚Üê Voltar</button>
                            )}
                            
                            <div className="bg-white rounded-3xl shadow-2xl p-8 mb-6">
                                <div className="text-center mb-8">
                                    <h1 className="text-5xl font-bold text-purple-900 mb-2">üè• Posto de Sa√∫de</h1>
                                    <div className="text-3xl font-bold text-purple-700">Luanda</div>
                                    <div className="text-2xl text-gray-600 mt-4">
                                        {currentTime.toLocaleTimeString('pt-BR')}
                                    </div>
                                </div>

                                {lastCalled && (
                                    <div className="bg-gradient-to-r from-purple-600 to-purple-700 p-12 rounded-2xl mb-8 animate-pulse">
                                        <div className="text-center text-white">
                                            <div className="text-3xl mb-4">CHAMANDO SENHA</div>
                                            <div className="text-9xl font-bold mb-4">#{lastCalled.number}</div>
                                            <div className="text-4xl font-bold mb-4">{lastCalled.name}</div>
                                            {lastCalled.examRoom && (
                                                <div className="text-3xl mt-4">
                                                    Sala {lastCalled.examRoom}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}

                                <div className="grid md:grid-cols-2 gap-6">
                                    <div className="bg-blue-50 p-6 rounded-xl">
                                        <h3 className="text-2xl font-bold text-blue-900 mb-4">
                                            üîµ Aguardando Consulta ({patients.filter(p => p.status === 'waiting').length})
                                        </h3>
                                        <div className="space-y-2 max-h-96 overflow-y-auto">
                                            {patients.filter(p => p.status === 'waiting').slice(0, 10).map(p => (
                                                <div key={p.id} className="bg-white p-4 rounded-lg flex justify-between items-center shadow">
                                                    <span className="text-3xl font-bold text-blue-900">#{p.number}</span>
                                                    <span className="text-xl">{p.name}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="bg-teal-50 p-6 rounded-xl">
                                        <h3 className="text-2xl font-bold text-teal-900 mb-4">
                                            üî¨ Em Exames ({patients.filter(p => p.status === 'exam').length})
                                        </h3>
                                        <div className="space-y-2 max-h-96 overflow-y-auto">
                                            {patients.filter(p => p.status === 'exam').map(p => (
                                                <div key={p.id} className="bg-white p-4 rounded-lg shadow">
                                                    <div className="flex justify-between items-center">
                                                        <span className="text-2xl font-bold text-teal-900">#{p.number}</span>
                                                        <span className="text-xl">{p.name}</span>
                                                        <span className="text-lg font-bold">Sala {p.examRoom}</span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                <div className="mt-6 bg-pink-50 p-6 rounded-xl">
                                    <h3 className="text-2xl font-bold text-pink-900 mb-4">
                                        üíä Aguardando na Farm√°cia ({patients.filter(p => p.status === 'pharmacy').length})
                                    </h3>
                                    <div className="grid grid-cols-5 gap-3">
                                        {patients.filter(p => p.status === 'pharmacy').map(p => (
                                            <div key={p.id} className="bg-white p-3 rounded-lg text-center shadow">
                                                <div className="text-2xl font-bold text-pink-900">#{p.number}</div>
                                                <div className="text-sm text-gray-600 truncate">{p.name}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="mt-6 grid grid-cols-2 gap-4">
                                    <div className="bg-gradient-to-br from-green-400 to-green-600 p-6 rounded-xl text-white text-center">
                                        <div className="text-5xl font-bold">{patients.filter(p => p.status === 'consulting').length}</div>
                                        <div className="text-xl mt-2">Em Consulta</div>
                                    </div>
                                    <div className="bg-gradient-to-br from-gray-400 to-gray-600 p-6 rounded-xl text-white text-center">
                                        <div className="text-5xl font-bold">{patients.filter(p => p.status === 'completed').length}</div>
                                        <div className="text-xl mt-2">Atendidos Hoje</div>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-purple-800 text-white p-6 rounded-2xl text-center">
                                <div className="text-2xl font-bold">üïê Hor√°rio de Atendimento: 8h √†s 17h</div>
                                <div className="text-lg mt-2 opacity-90">
                                    Em caso de emerg√™ncia, dirija-se diretamente ao pronto-socorro
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Paciente
            const PatientView = () => {
                const [searchNumber, setSearchNumber] = useState('');
                const [foundPatient, setFoundPatient] = useState(null);

                const searchPatient = () => {
                    const patient = patients.find(p => p.number === parseInt(searchNumber));
                    if (patient) {
                        setFoundPatient(patient);
                    } else {
                        alert('Senha n√£o encontrada!');
                        setFoundPatient(null);
                    }
                };

                const getStatusMessage = (patient) => {
                    switch(patient.status) {
                        case 'waiting':
                            const ahead = patients.filter(p => 
                                p.status === 'waiting' && 
                                (p.priority === 'urgent' || 
                                (p.priority === 'priority' && patient.priority === 'normal') ||
                                (p.priority === patient.priority && p.number < patient.number))
                            ).length;
                            return {
                                status: '‚è≥ Aguardando na Fila',
                                message: `H√° ${ahead} pessoa(s) √† sua frente`,
                                color: 'bg-blue-100 text-blue-900',
                                location: 'Permane√ßa na sala de espera'
                            };
                        case 'consulting':
                            return {
                                status: 'ü©∫ Em Consulta M√©dica',
                                message: 'Voc√™ est√° sendo atendido agora',
                                color: 'bg-green-100 text-green-900',
                                location: 'Consult√≥rio M√©dico'
                            };
                        case 'exam':
                            return {
                                status: 'üî¨ Exame em Andamento',
                                message: `Exame: ${patient.examType}`,
                                color: 'bg-teal-100 text-teal-900',
                                location: `Dirija-se √† Sala de Exame ${patient.examRoom}`
                            };
                        case 'pharmacy':
                            return {
                                status: 'üíä Aguardando na Farm√°cia',
                                message: 'Sua receita est√° pronta',
                                color: 'bg-pink-100 text-pink-900',
                                location: 'Dirija-se √† Farm√°cia'
                            };
                        case 'completed':
                            return {
                                status: '‚úÖ Atendimento Conclu√≠do',
                                message: 'Obrigado pela visita!',
                                color: 'bg-gray-100 text-gray-900',
                                location: 'Atendimento finalizado'
                            };
                        default:
                            return {
                                status: 'Status desconhecido',
                                message: '',
                                color: 'bg-gray-100',
                                location: ''
                            };
                    }
                };

                const backBtn = () => {
                    if (userRole === 'admin') setView('menu');
                    else if (userRole === 'reception') setView('reception');
                    else if (userRole === 'public') setView('public-menu');
                    else logout();
                };

                return (
                    <div className="min-h-screen bg-orange-50 p-4">
                        <div className="max-w-2xl mx-auto">
                            <button onClick={backBtn} className="mb-4 text-orange-600 hover:underline font-bold">‚Üê Voltar</button>
                            
                            <div className="bg-white rounded-lg shadow-xl p-6">
                                <h2 className="text-2xl font-bold text-orange-900 mb-6 text-center">
                                    üì± Acompanhamento do Paciente
                                </h2>
                                
                                <div className="mb-6">
                                    <label className="block text-sm font-bold mb-2">Digite o N√∫mero da Sua Senha</label>
                                    <div className="flex gap-2">
                                        <input type="number" value={searchNumber}
                                            onChange={(e) => setSearchNumber(e.target.value)}
                                            className="flex-1 p-4 border-2 border-orange-300 rounded-lg text-2xl text-center font-bold"
                                            placeholder="000"/>
                                        <button onClick={searchPatient}
                                            className="bg-orange-600 hover:bg-orange-700 text-white px-8 rounded-lg font-bold">
                                            Buscar
                                        </button>
                                    </div>
                                </div>

                                {foundPatient && (
                                    <div className="space-y-4">
                                        <div className="bg-orange-100 p-6 rounded-lg text-center">
                                            <div className="text-6xl font-bold text-orange-900 mb-2">#{foundPatient.number}</div>
                                            <div className="text-2xl font-bold text-orange-900">{foundPatient.name}</div>
                                        </div>

                                        <div className={`p-6 rounded-lg ${getStatusMessage(foundPatient).color}`}>
                                            <div className="text-3xl font-bold mb-2">{getStatusMessage(foundPatient).status}</div>
                                            <div className="text-lg mb-2">{getStatusMessage(foundPatient).message}</div>
                                            <div className="text-xl font-bold mt-4">üìç {getStatusMessage(foundPatient).location}</div>
                                        </div>

                                        {foundPatient.status === 'exam' && examResults[foundPatient.id] && (
                                            <div className="bg-green-100 p-4 rounded-lg">
                                                <div className="font-bold text-green-900 mb-2">‚úÖ Exame Conclu√≠do</div>
                                                <div className="text-sm text-gray-700">
                                                    Retorne ao consult√≥rio m√©dico para avalia√ß√£o
                                                </div>
                                            </div>
                                        )}

                                        <div className="bg-blue-50 p-4 rounded-lg text-sm">
                                            <div className="font-bold mb-2">‚è∞ Hora de Chegada:</div>
                                            <div>{foundPatient.timestamp}</div>
                                        </div>

                                        <div className="bg-yellow-50 p-4 rounded-lg text-sm text-center">
                                            <div className="font-bold mb-1">üí° Dica</div>
                                            <div>Mantenha-se pr√≥ximo das telas de chamada e fique atento ao seu n√∫mero</div>
                                        </div>
                                    </div>
                                )}

                                {!foundPatient && searchNumber && (
                                    <div className="bg-gray-100 p-8 rounded-lg text-center text-gray-600">
                                        Nenhum paciente encontrado com essa senha
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div>
                    {view === 'login' && <LoginView />}
                    {view === 'public-menu' && <PublicMenuView />}
                    {view === 'menu' && <MenuView />}
                    {view === 'reception' && <ReceptionView />}
                    {view === 'doctor' && <DoctorView />}
                    {view === 'exam' && <ExamView />}
                    {view === 'pharmacy' && <PharmacyView />}
                    {view === 'display' && <DisplayView />}
                    {view === 'patient' && <PatientView />}
                </div>
            );
        };

        ReactDOM.render(<ClinicQueueSystem />, document.getElementById('root'));
    </script>
</body>
</html>
